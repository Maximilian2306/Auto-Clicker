name: Build and Release

on:
  push:
    tags:
      - 'v*'  # Trigger on version tags (e.g., v1.0.0, v1.2.3)

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller

    - name: Build executable
      run: python build.py

    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ClickMAX-Windows
        path: dist/ClickMAX.exe

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/ClickMAX-Windows.zip
          dist/ClickMAX.exe
        body: |
          ## ClickMAX Release ${{ github.ref_name }}

          ### Installation
          1. Download `ClickMAX.exe` or `ClickMAX-Windows.zip`
          2. Extract (if ZIP) and run `ClickMAX.exe`
          3. No installation required - portable application

          ### Features
          - Mouse automation with click patterns (Circle, Square, Star, Spiral, Zigzag, Random, Figure-8, Line)
          - Macro recording and playback
          - Global hotkeys (F6, F7, F3-F5, ESC)
          - Profile management
          - Multi-language support (EN/DE/ES/FR)
          - Modern GUI with ttkbootstrap themes
          - Statistics and session tracking

          ### System Requirements
          - Windows 10/11
          - No Python installation required

          ### Notes
          - Windows Defender may show a warning (expected for unsigned executables)
          - Add exception if needed: Settings > Update & Security > Windows Security > Virus & threat protection

          ---
          **Full Changelog**: https://github.com/${{ github.repository }}/commits/${{ github.ref_name }}
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
